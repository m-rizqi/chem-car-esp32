<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Monitoring Sensor</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>    
    </head>
    <body>
        <div class="container">
            <div class="potentiometer">
                <canvas id="potentiometer_chart" style="width: 100%; box-sizing: border-box;"></canvas>
            </div>
            <div class="humidity"></div>
            <div class="temperature"></div>
        </div>
        <script>
            var gateway = `ws://${window.location.hostname}/ws`;
            var websocket;
            window.addEventListener('load', onLoad);
            google.charts.load('current', {'packages':['gauge']});
            function initWebSocket() {
                console.log('Trying to open a WebSocket connection...');
                websocket = new WebSocket(gateway);
                websocket.onopen    = onOpen;
                websocket.onclose   = onClose;
                websocket.onmessage = onMessage; 
            }
            function onOpen(event) {
                console.log('Connection opened');
            }
            function onClose(event) {
                console.log('Connection closed');
                setTimeout(initWebSocket, 2000);
            }
            function onMessage(event) {
                const data = JSON.parse(event.data);
                drawChart(data);
            }
            function drawChart(data){
                const potentiometer_chart_ctx = document.getElementById('potentiometer_chart');

                new Chart(potentiometer_chart_ctx, {
                    type: 'line',
                    data: {
                    labels: data.times,
                    datasets: [{
                        label: 'Potentiometer',
                        data: data.potentiometer,
                        borderWidth: 1
                    }]
                    },
                    options: {
                    scales: {
                        y: {
                        beginAtZero: true
                        }
                    }
                    }
                });

            };
            function onLoad(event) {
                initWebSocket();
            }
        </script>
    </body>
</html>